<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Stake Rolex</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body {
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:#fff;
    font-family:'Orbitron', sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
}
h1 {text-shadow: 2px 2px 5px rgba(0,0,0,0.5);}
.container {
    background: linear-gradient(145deg,#1c1c1c,#2c2c2c);
    padding:20px;
    border-radius:15px;
    margin:20px;
    width:360px;
    text-align:center;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
}
input, select, button {
    margin:10px 0;
    padding:10px;
    width:80%;
    border-radius:10px;
    border:none;
    font-size:16px;
    outline:none;
}
input, select { background:#222; color:#fff; }
button {
    background: linear-gradient(90deg,#ff5500,#ffdd00);
    color:#000;
    cursor:pointer;
    font-weight:bold;
    transition: 0.3s;
}
button:hover { transform: scale(1.1); box-shadow:0 0 10px #ff0,0 0 20px #f50; }
#balance { font-size:20px; margin-bottom:20px; color:#0f0; text-shadow:1px 1px 5px #000; }
#rouletteCanvas { background:#111; border-radius:50%; margin:20px auto; display:block; }
#slotSymbols { font-size:55px; margin:20px 0; transition: transform 0.3s; }
.win { color:#0f0; font-weight:bold; animation: glow 1s infinite alternate; }
.lose { color:#f00; font-weight:bold; animation: shake 0.5s; }
@keyframes glow { 0%{text-shadow:0 0 5px #0f0;} 50%{text-shadow:0 0 20px #0f0,0 0 30px #0f0;} 100%{text-shadow:0 0 5px #0f0;} }
@keyframes shake { 0%{transform:translateX(0px);} 25%{transform:translateX(-5px);} 50%{transform:translateX(5px);} 75%{transform:translateX(-5px);} 100%{transform:translateX(0px);} }
#loginBox, #historyBox {width:360px; margin:10px auto; background:#1c1c1c; padding:15px; border-radius:10px;}
#loginBox {text-align:center;}
#historyBox {max-height:200px; overflow-y:auto; text-align:left; font-size:14px;}
</style>
</head>
<body>

<h1>Stake Rolex</h1>

<!-- Login -->
<div id="loginBox">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"><br>
  <input id="pin" type="password" placeholder="PIN"><br>
  <label><input type="checkbox" id="remember"> ØªØ°ÙƒØ±Ù†ÙŠ</label><br>
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Panel Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="panel" style="display:none;">
  <h2>Ù…Ø±Ø­Ø¨Ø§ <span id="name"></span></h2>
  <p id="balance">Ø±ØµÙŠØ¯Ùƒ: 0</p>

  <!-- Ø´Ø­Ù† / Ø³Ø­Ø¨ -->
  <div class="container">
    <h2>ğŸ’³ Ø´Ø­Ù† / Ø³Ø­Ø¨</h2>
    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
    <input type="number" id="transferAmount" min="1">
    <button onclick="depositFromStake()">Ø´Ø­Ù† Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</button>
    <button onclick="withdrawToStake()">Ø³Ø­Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</button>
    <p id="transferMsg"></p>
  </div>

  <!-- Ø±ÙˆÙ„ÙŠØª -->
  <div class="container" id="roulette-game">
    <h2>ğŸ¯ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±ÙˆÙ„ÙŠØª</h2>
    <canvas id="rouletteCanvas" width="300" height="300"></canvas>
    <label>Ø§Ø®ØªØ± Ø±Ù‚Ù… (0-36):</label>
    <input type="number" id="userNumber" min="0" max="36">
    
    <label>Ø£Ùˆ Ø§Ø®ØªØ± Ù„ÙˆÙ†:</label>
    <select id="userColor">
      <option value="">--Ø§Ø®ØªØ±--</option>
      <option value="Ø£Ø­Ù…Ø±">Ø£Ø­Ù…Ø±</option>
      <option value="Ø£Ø³ÙˆØ¯">Ø£Ø³ÙˆØ¯</option>
      <option value="Ø£Ø²Ø±Ù‚">Ø£Ø²Ø±Ù‚</option>
      <option value="Ø£Ø®Ø¶Ø± ÙØ§ØªØ­">Ø£Ø®Ø¶Ø± ÙØ§ØªØ­</option>
      <option value="Ø¨Ù†ÙØ³Ø¬ÙŠ">Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
    </select>

    <label>Ø§Ù„Ø±Ù‡Ø§Ù†:</label>
    <input type="number" id="betAmount" min="1">

    <button onclick="spinRoulette()">Ø¯ÙˆØ± Ø§Ù„Ø±ÙˆÙ„ÙŠØª</button>
    <p id="rouletteResult"></p>
  </div>

  <!-- Slot Machine 4X -->
  <div class="container" id="slot-game">
    <h2>ğŸ° Ù…Ø§ÙƒÙŠÙ†Ø© Ø§Ù„Ø­Ø¸ 4X</h2>
    <label>Ø§Ù„Ø±Ù‡Ø§Ù†:</label>
    <input type="number" id="slotBet" min="1">
    <button onclick="spinSlot()">ØªØ´ØºÙŠÙ„</button>
    <p id="slotResult"></p>
    <div id="slotSymbols"></div>
  </div>

  <!-- History -->
  <div id="historyBox">
    <h3>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
  </div>

  <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyAM7gLKuLRfhFdWyakFS1jU4c8xU1fg-FU",
  authDomain:"family-bank-966ae.firebaseapp.com",
  databaseURL:"https://family-bank-966ae-default-rtdb.firebaseio.com",
  projectId:"family-bank-966ae"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser = "";
let balance = 0;

// =================== Auto Login ===================
window.onload = function(){
 let saved = localStorage.getItem("bankUser");
 if(saved){
    saved = JSON.parse(saved);
    document.getElementById("username").value = saved.username;
    document.getElementById("pin").value = saved.pin;
    login(true);
 }
}

// =================== Login Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† userStake ===================
function login(auto=false){
  let user = document.getElementById("username").value.trim();
  let pin = document.getElementById("pin").value.trim();
  if(!user || !pin){ alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©"); return; }

  // ØªØ­Ù‚Ù‚ Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ userStake
  db.ref("userStake/"+user).once("value").then(sStake=>{
      let stakeData = sStake.val();
      if(!stakeData){
          alert("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (userStake)");
          return;
      }

      // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡ ÙÙŠ userStakeØŒ Ù†ØªØ­Ù‚Ù‚ Ù…Ù† gamerolex
      db.ref("gamerolex/"+user).once("value").then(s=>{
          let data = s.val();
          if(!data){
              // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ gamerolex ÙÙ‚Ø· Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ userStake
              db.ref("gamerolex/"+user).set({pin: pin, balance:0, history:{}}).then(()=>{
                  data = {pin: pin, balance:0, history:{}};
                  alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!");
                  proceedLogin(user, data, auto);
              });
          } else {
              if(data.pin !== pin){ alert("PIN Ø®Ø§Ø·Ø¦"); return; }
              proceedLogin(user, data, auto);
          }
      });
  });
}

// =================== Ù…ØªØ§Ø¨Ø¹Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ===================
function proceedLogin(user, data, auto){
    currentUser = user;
    balance = Number(data.balance || 0);

    document.getElementById("loginBox").style.display="none";
    document.getElementById("panel").style.display="block";
    document.getElementById("name").innerText = user;
    updateBalance();

    if(document.getElementById("remember").checked || auto){
        localStorage.setItem("bankUser",JSON.stringify({username:user,pin:data.pin}));
    }

    loadHistory();
}

// =================== Logout ===================
function logout(){
  localStorage.removeItem("bankUser");
  location.reload();
}

// =================== Update Balance ===================
function updateBalance(){
  document.getElementById("balance").innerText = `Ø±ØµÙŠØ¯Ùƒ: ${balance} Ø±ØµÙŠØ¯`;
}

// =================== Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ===================
function saveHistory(type,amount){
  let time = new Date().toLocaleString();
  db.ref("gamerolex/"+currentUser+"/history").push({type,amount,time});
  loadHistory();
}

function loadHistory(){
  let box = document.getElementById("historyBox");
  db.ref("gamerolex/"+currentUser+"/history").on("value",snap=>{
    box.innerHTML = "<h3>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>";
    snap.forEach(s=>{
      let h = s.val();
      box.innerHTML += `â€¢ ${h.type} : ${h.amount} | ${h.time}<br>`;
    });
  });
}

// ------------------ Ø´Ø­Ù† ------------------
function depositFromStake(){
    let amount = parseFloat(document.getElementById("transferAmount").value);
    if(amount<=0){ transferMsg.innerText="âŒ Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­"; return; }

    db.ref("userStake/"+currentUser).once("value").then(s=>{
        let main = s.val();
        if(!main || main.balance < amount){ transferMsg.innerText="âŒ Ø±ØµÙŠØ¯Ùƒ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØºÙŠØ± ÙƒØ§ÙÙŠ"; return; }

        db.ref("userStake/"+currentUser+"/balance").transaction(b => (b||0)-amount);

        db.ref("gamerolex/"+currentUser).transaction(u=>{
            if(!u) u={balance:0};
            u.balance=(u.balance||0)+amount;
            return u;
        }).then(()=>{ 
            balance += amount;
            updateBalance();
            transferMsg.innerText=`âœ… ØªÙ… Ø´Ø­Ù† ${amount} Ø±ØµÙŠØ¯`; 
            saveHistory("Ø´Ø­Ù†",amount);
        });
    });
}

// ------------------ Ø³Ø­Ø¨ ------------------
function withdrawToStake(){
    let amount = parseFloat(document.getElementById("transferAmount").value);
    if(amount<=0){ transferMsg.innerText="âŒ Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­"; return; }
    if(amount>balance){ transferMsg.innerText="âŒ Ø±ØµÙŠØ¯ Rolex ØºÙŠØ± ÙƒØ§ÙÙŠ"; return; }

    db.ref("gamerolex/"+currentUser+"/balance").transaction(b=> (b||0)-amount);
    db.ref("userStake/"+currentUser+"/balance").transaction(b => (b||0)+amount)
    .then(()=>{
        balance -= amount;
        updateBalance();
        transferMsg.innerText=`âœ… ØªÙ… Ø§Ù„Ø³Ø­Ø¨`; 
        saveHistory("Ø³Ø­Ø¨",amount);
    });
}

// ----------------- Ø±ÙˆÙ„ÙŠØª -----------------
const canvas = document.getElementById("rouletteCanvas");
const ctx = canvas.getContext("2d");
const numbers = Array.from({length:37},(_,i)=>i);
const colorList = ["red","black","blue","lightgreen","purple"];
let angle=0;

function drawRoulette(){
    const center=canvas.width/2;
    const radius=center-10;
    const slice=2*Math.PI/numbers.length;
    for(let i=0;i<numbers.length;i++){
        ctx.beginPath();
        ctx.moveTo(center,center);
        ctx.arc(center,center,radius,i*slice,(i+1)*slice);
        ctx.fillStyle = i===0?"green":colorList[i%colorList.length];
        ctx.fill();
        ctx.strokeStyle="#fff";
        ctx.stroke();
        ctx.save();
        ctx.translate(center,center);
        ctx.rotate(i*slice+slice/2);
        ctx.fillStyle="#fff";
        ctx.font="12px Arial";
        ctx.fillText(numbers[i],radius-20,0);
        ctx.restore();
    }
}

function spinRoulette(){
    let userNumber=parseInt(document.getElementById("userNumber").value);
    let userColor=document.getElementById("userColor").value;
    let betAmount=parseFloat(document.getElementById("betAmount").value);
    if(betAmount>balance || betAmount<=0){alert("Ø§Ù„Ø±Ù‡Ø§Ù† ØºÙŠØ± ØµØ§Ù„Ø­!");return;}

    let spinDuration=3000+Math.random()*2000;
    let start=null;
    let totalAngle=Math.random()*2*Math.PI+10*Math.PI;

    function animate(t){
        if(!start)start=t;
        let p=t-start;
        let percent=Math.min(p/spinDuration,1);
        angle=totalAngle*(1-Math.pow(1-percent,3));
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.save();
        ctx.translate(canvas.width/2,canvas.height/2);
        ctx.rotate(angle);
        ctx.translate(-canvas.width/2,-canvas.height/2);
        drawRoulette();
        ctx.restore();
        if(percent<1)requestAnimationFrame(animate);
        else finishRoulette();
    }

    function finishRoulette(){
        const finalIndex=Math.floor(numbers.length-(angle%(2*Math.PI))/(2*Math.PI/numbers.length))%numbers.length;
        const rouletteNumber=numbers[finalIndex];
        const rouletteColor = (rouletteNumber===0)? "green" : colorList[finalIndex%colorList.length];

        let resultText=`Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙØ§Ø¦Ø²: ${rouletteNumber} - Ø§Ù„Ù„ÙˆÙ†: ${rouletteColor} <br>`;

        if(rouletteNumber===0){
            balance-=betAmount*2;
            resultText+=`<span class="lose">ØµÙØ±! Ø®Ø³Ø§Ø±Ø© Ã—2</span>`;
        }
        else if(userNumber===rouletteNumber){
            let win=betAmount*10; balance+=win;
            resultText+=`<span class="win">ÙØ²Øª Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… +${win}</span>`;
        }
        else if(userColor && userColor===rouletteColor){
            let win=betAmount*1.1; balance+=win;
            resultText+=`<span class="win">Ø±Ø¨Ø­ Ù„ÙˆÙ† +${win}</span>`;
        }
        else{
            balance-=betAmount;
            resultText+=`<span class="lose">Ø®Ø³Ø§Ø±Ø©!</span>`;
        }

        db.ref("gamerolex/"+currentUser).update({balance:balance});
        document.getElementById("rouletteResult").innerHTML=resultText;
        updateBalance();
        saveHistory("Ø±ÙˆÙ„ÙŠØª",betAmount);
    }
    requestAnimationFrame(animate);
}
drawRoulette();

// ----------------- Slot Machine 4X -----------------
let slotBusy = false;

function spinSlot(){
    if(slotBusy) return;
    slotBusy = true;

    let bet=parseFloat(document.getElementById("slotBet").value);
    if(bet>balance||bet<=0){alert("Ø§Ù„Ø±Ù‡Ø§Ù† ØºÙŠØ± ØµØ§Ù„Ø­!");slotBusy=false;return;}

    let symbols=["ğŸ’","ğŸ‹","ğŸ‰","â­","ğŸ’","ğŸ‘‘"];
    let slotDiv=document.getElementById("slotSymbols");
    let spinCount=30;
    let i=0;

    let tempInterval=setInterval(()=>{
        let temp = [
          symbols[Math.floor(Math.random()*symbols.length)],
          symbols[Math.floor(Math.random()*symbols.length)],
          symbols[Math.floor(Math.random()*symbols.length)],
          symbols[Math.floor(Math.random()*symbols.length)]
        ];
        slotDiv.innerHTML = temp.join(" | ");
        slotDiv.style.transform=`scale(1.2) rotate(${Math.sin(i)*10}deg)`;
        i++;
        if(i>=spinCount){
            clearInterval(tempInterval);

            let final = [
                symbols[Math.floor(Math.random()*symbols.length)],
                symbols[Math.floor(Math.random()*symbols.length)],
                symbols[Math.floor(Math.random()*symbols.length)],
                symbols[Math.floor(Math.random()*symbols.length)]
            ];

            slotDiv.innerHTML = final.join(" | ");
            slotDiv.style.transform="scale(1)";

            let count = {};
            final.forEach(s=>count[s]=(count[s]||0)+1);
            let max = Math.max(...Object.values(count));

            let result="";
            if(max===4){
                let win=bet*2.5;
                balance+=win;
                result=`<span class="win">ğŸ”¥ 4 Ù…ØªØ´Ø§Ø¨Ù‡Ø©! +${win}</span>`;
            }
            else if(max===3){
                let win=bet*0.9;
                balance+=win;
                result=`<span class="win">â­ 3 Ù…ØªØ´Ø§Ø¨Ù‡Ø©! +${win}</span>`;
            }
            else if(max===2){
                let win=bet*0.5;
                balance+=win;
                result=`<span class="win">ğŸ’  2 Ù…ØªØ´Ø§Ø¨Ù‡Ø©! +${win}</span>`;
            }
            else{
                balance-=bet;
                result=`<span class="lose">âŒ Ø®Ø³Ø§Ø±Ø©!</span>`;
            }

            document.getElementById("slotResult").innerHTML=result;
            db.ref("gamerolex/"+currentUser).update({balance:balance});
            updateBalance();
            saveHistory("Ù…Ø§ÙƒÙŠÙ†Ø© Ø§Ù„Ø­Ø¸",bet);
            slotBusy=false;
        }
    },80);
}
</script>
</body>
</html>
